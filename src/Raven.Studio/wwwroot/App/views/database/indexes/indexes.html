<div class="indexes">
    <div data-bind="visible: sortedGroups().length === 0">
        <div class="row">
            <div class="col-sm-8 col-sm-offset-2 col-lg-6 col-lg-offset-3">
                <i class="icon-xl icon-empty-set text-muted"></i>
                <h2 class="text-center">No indexes have been created for this database.</h2>
                <p class="lead text-center text-muted">Go ahead and <a href="#" data-bind="attr: { href: newIndexUrl }">create one now</a>.</p>
            </div>
        </div>
    </div>
    <div class="clearfix toolbar" data-bind="if: sortedGroups().length">
        <div class="pull-left">
            <div class="form-inline">
                <div class="checkbox checkbox-primary checkbox-inline align-checkboxes" title="Select all or none">
                    <input type="checkbox" class="styled" data-bind="checkboxTriple: indexesSelectionState, event: { change: toggleSelectAll }" />
                    <label></label>
                </div>
                <div class="input-group">
                    <input type="text" accesskey="/" class="form-control" placeholder="Filter" title="Filter indexes (Alt+/)" data-bind="textInput: searchText" />
                </div>

                <div class="indexesToolbar-actions">
                    <a class="btn btn-primary" data-bind="attr: { href: newIndexUrl }">
                        <i class="icon-plus"></i>
                        <span>New index</span>
                    </a>
                    <div class="btn-group-label" data-bind="css: { active: selectedIndexesName().length }" data-label="Selection" role="group">
                        <button class="btn btn-danger" data-bind="click: deleteSelectedIndexes, enable: selectedIndexesName().length"><i class="icon-trash"></i><span>Delete</span></button>
                        <div class="btn-group">
                            <button type="button" class="btn btn-default dropdown-toggle" title="Change the options of selected indexes"
                                    data-bind="enable: $root.globalIndexingStatus() === 'Running' && selectedIndexesName().length && !spinners.globalLockChanges(), css: { 'btn-spinner': spinners.globalLockChanges() }" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="icon-play"></i><span>Set state...</span>
                                <span class="caret"></span>
                                <span class="sr-only">Toggle Dropdown</span>
                            </button>
                            <ul class="dropdown-menu">                                
                                <li data-bind="click: enableSelectedIndexes">
                                    <a href="#" title="Enable">
                                        <i class="icon-play"></i>
                                        <span>Enable</span>
                                    </a>
                                </li>
                                <li data-bind="click: disableSelectedIndexes">
                                    <a href="#" title="Disable">
                                        <i class="icon-lock"></i>
                                        <span>Disable</span>
                                    </a>
                                </li>
                                <li class="divider"></li>
                                <li data-bind="click: resumeSelectedIndexes">
                                    <a href="#" title="Resume">
                                        <i class="icon-play"></i>
                                        <span>Resume</span>
                                    </a>
                                </li>
                                <li data-bind="click: pauseSelectedIndexes">
                                    <a href="#" title="Pause">
                                        <i class="icon-pause"></i>
                                        <span>Pause</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <div class="btn-group">
                            <button type="button" class="btn btn-default dropdown-toggle" title="Change the options of selected indexes"
                                    data-bind="enable: $root.globalIndexingStatus() === 'Running' && selectedIndexesName().length && !spinners.globalLockChanges(), css: { 'btn-spinner': spinners.globalLockChanges() }" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="icon-lock"></i><span>Set lock mode...</span>
                                <span class="caret"></span>
                                <span class="sr-only">Toggle Dropdown</span>
                            </button>
                            <ul class="dropdown-menu">
                                <li data-bind="click: unlockSelectedIndexes">
                                    <a href="#" title="Unlock selected indexes">
                                        <i class="icon-unlock"></i>
                                        <span>Unlock</span>
                                    </a>
                                </li>
                                <li data-bind="click: lockSelectedIndexes">
                                    <a href="#" title="Lock selected indexes">
                                        <i class="icon-lock"></i>
                                        <span>Lock</span>
                                    </a>
                                </li>
                                <li data-bind="click: lockSideBySideSelectedIndexes">
                                    <a href="#" title="Lock (Side by Side) selected indexes">
                                        <i class="icon-lock-sidebyside"></i>
                                        <span>Lock (Side by Side)</span>
                                    </a>
                                </li>
                                <li data-bind="click: lockErrorSelectedIndexes">
                                    <a href="#" title="Lock (Error) selected indexes">
                                        <i class="icon-lock-error"></i>
                                        <span>Lock (Error)</span>
                                    </a>
                                </li>                               
                            </ul>
                        </div>
                    </div>
                 </div>
            </div>
        </div>
        <div class="pull-right" id="toggleIndexing">
            <button class="btn btn-default disable-indexing" title="Pause indexing process for ALL indexes until restart"
                    data-bind="click: stopIndexing, visible: $root.globalIndexingStatus() !== 'Paused', enable: !spinners.globalStartStop() && $root.globalIndexingStatus() !== 'Disabled', css: { 'btn-spinner': spinners.globalStartStop() }">
                <i class="icon-pause"></i>
                <span>Pause indexing until restart</span>
            </button>
            <button class="btn btn-success enable-indexing" title="Resume indexing process"
                    data-bind="click: startIndexing, visible: $root.globalIndexingStatus() === 'Paused', enable: !spinners.globalStartStop(), css: { 'btn-spinner': spinners.globalStartStop() }">
                <i class="icon-play"></i>
                <span>Resume indexing</span>
            </button>
        </div>
    </div>
    <div data-bind="foreach: sortedGroups">
        <h2 data-bind="text: entityName, visible: !groupHidden()"></h2>
        <div data-bind="foreach: indexes, visible: !groupHidden()">
            <div class="panel panel-state index" data-bind="visible: !filteredOut()">
                <div class="padding padding-sm">
                    <div data-bind="attr: { class: 'state ' + badgeClass(), 'data-state-text' : badgeText() }"></div>
                    <div class="row">
                        <div class="col-xs-12 col-sm-6 col-xl-4 info-container">
                            <div class="checkbox">
                                <input type="checkbox" class="styled" data-bind="checked: $root.selectedIndexesName, checkedValue: name">
                                <label></label>
                            </div>
                            <h3 class="index-name">
                                <a href="#" data-bind="text: name, attr: { href: queryUrl(), title: name }"></a>
                            </h3>
                            <div class="index-type">
                                <span data-bind="text: getTypeForUI()"></span>
                                &nbsp; <span data-bind="visible: isTestIndex" class="label label-warning">TEST INDEX</span>
                            </div>
                        </div>
                        <div class="col-xs-12 col-sm-12 col-xl-5 vertical-divider properties-container" data-bind="if: !isFaulty()">

                            <div class="properties-item state-selector" data-bind="template: { name: 'state-template' }">
                            </div>
                            <div class="properties-item priority" data-bind="template: { name: 'priority-template' }">
                            </div>
                            <div class="properties-item mode" data-bind="template: { name: 'lock-mode-template' }">
                            </div>
                            <div class="properties-item entriesCount">
                                <div class="properties-value value-only">
                                    <div class="set-size">
                                        <i class="icon-list"></i><span data-bind="text: $root.pluralize(entriesCount, 'entry', 'entries')"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="properties-item staleness" data-bind="visible: isStale()">
                                <div class="properties-value value-only">
                                    <div class="set-size">
                                        <i class="icon-reset"></i><span>Stale</span>
                                    </div>
                                </div>
                            </div>
                            <div class="properties-item text-success staleness" data-bind="visible: !isStale()">
                                <div class="properties-value value-only">
                                    <div class="set-size">
                                        <i class="icon-check"></i><span>Up to date</span>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="col-xs-12 col-sm-6 col-xl-3 actions-container">
                            <div class="actions">
                                <div class="btn-toolbar pull-right-sm" role="toolbar">
                                    <div class="btn-group" role="group" data-bind="if: !isFaulty()">
                                        <a class="btn btn-default" data-bind="attr: { href: queryUrl() }"><i class="icon-search"></i><span>Query</span></a>
                                    </div>
                                    <div class="btn-group" role="group" data-bind="if: !isFaulty()">
                                        <a class="btn btn-default" data-bind="attr: { href: editUrl() }" title="Edit index"><i class="icon-edit"></i></a>
                                        <button class="btn btn-default" data-bind="click: $root.resetIndex" title="Reset index"><i class="icon-reset"></i></button>
                                    </div>
                                    <div class="btn-group" role="group">
                                        <button class="btn btn-danger" data-bind="click: $root.deleteIndex" title="Delete the index"><i class="icon-trash"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script type="text/html" id="priority-template">
    <span class="properties-label">Priority:</span>
    <div class="btn-group properties-value">
        <button type="button" class="btn set-size dropdown-toggle" data-toggle="dropdown"
                data-bind="css: { 'btn-spinner': _.includes($root.spinners.localPriority(), name) }, enable: $root.globalIndexingStatus() === 'Running' && !_.includes($root.spinners.localPriority(), name)">
            <span data-bind="visible: isNormalPriority()">
                <i class="icon-check"></i>
                <span>Normal</span>
            </span>
            <span data-bind="visible: isLowPriority()">
                <i class="icon-coffee"></i>
                <span>Low</span>
            </span>
            <span data-bind="visible: isHighPriority()">
                <i class="icon-force"></i>
                <span>High</span>
            </span>
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
            <li>
                <a href="#" data-bind="click: $root.lowPriority" title="Low">
                    <i class="icon-coffee"></i><span>Low</span>
                </a>
            </li>
            <li>
                <a href="#" data-bind="click: $root.normalPriority" title="Normal">
                    <i class="icon-check"></i><span>Normal</span>
                </a>
            </li>
            <li>
                <a href="#" data-bind="click: $root.highPriority" title="High">
                    <i class="icon-force"></i><span>High</span>
                </a>
            </li>
        </ul>
    </div>
</script>

<script type="text/html" id="state-template">
    <span class="properties-label">State:</span>
    <div class="btn-group properties-value">
        <button type="button" class="btn set-size dropdown-toggle" data-toggle="dropdown"
                data-bind="css: { 'btn-spinner': _.includes($root.spinners.localState(), name) }, 
                enable: $root.globalIndexingStatus() === 'Running'  && !_.includes($root.spinners.localState(), name)">
            <span class="text-warning" data-bind="visible: isPausedState()">
                <i class="icon-cancel"></i>
                <span>Paused until restart</span>
            </span>
            <span data-bind="visible: isNormalState()">
                <i class="icon-check"></i>
                <span>Normal</span>
            </span>
            <span data-bind="visible: isIdleState()">
                <i class="icon-coffee"></i>
                <span>Idle</span>
            </span>
            <span class="text-danger" data-bind="visible: isDisabledState()">
                <i class="icon-cancel"></i>
                <span>Disabled</span>
            </span>
            <span class="text-danger" data-bind="visible: isErrorState()">
                <i class="icon-danger"></i>
                <span>Error</span>
            </span>
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
            <li data-bind="visible: canBeEnabled()">
                <a href="#" data-bind="click: $root.enableIndex" title="Enable">
                    <i class="icon-check"></i><span>Enable</span>
                </a>
            </li>
            <li data-bind="visible: canBeDisabled()">
                <a href="#" data-bind="click: $root.disableIndex" title="Disable">
                    <i class="icon-cancel"></i><span>Disable</span>
                </a>
            </li>
            <li data-bind="visible: canBePaused()">
                <a href="#" class="text-warning" data-bind="click: $root.pauseUntilRestart" title="Pause until restart">
                    <i class="icon-pause"></i><span>Pause until restart</span>
                </a>
            </li>
            <li data-bind="visible: canBeResumed()">
                <a href="#" class="text-success" data-bind="click: $root.resumeIndexing" title="Resume indexing">
                    <i class="icon-check"></i><span>Resume indexing</span>
                </a>
            </li>
        </ul>
    </div>
</script>

<script type="text/html" id="lock-mode-template">
    <span class="properties-label">Mode:</span>
    <div class="btn-group properties-value">
        <button type="button" class="btn btn-block set-size dropdown-toggle" data-toggle="dropdown"
                data-bind="css: { 'btn-spinner': _.includes($root.spinners.localLockChanges(), name) }, enable: $root.globalIndexingStatus() === 'Running' && 
                !_.includes($root.spinners.localLockChanges(), name)">
            <span data-bind="visible: lockMode() === 'Unlock'">
                <i class="icon-unlock"></i><span>Unlocked</span>
            </span>
            <span data-bind="visible: lockMode() === 'SideBySide'">
                <i class="icon-lock-sidebyside"></i><span>Locked (side-by-side)</span>
            </span>
            <span data-bind="visible: lockMode() === 'LockedIgnore'">
                <i class="icon-lock"></i><span>Locked</span>
            </span>
            <span data-bind="visible: lockMode() === 'LockedError'">
                <i class="icon-lock-error"></i><span>Locked (Error)</span>
            </span>
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
            <li>
                <a href="#" data-bind="click: $root.unlockIndex" title="Unlocked: The index is unlocked for changes; apps can modify it, e.g. via IndexCreation.CreateIndexes().">
                    <i class="icon-unlock"></i>
                    <span>Unlock</span>
                </a>
            </li>
            <li class="divider"></li>
            <li>
                <a href="#" data-bind="click: $root.lockIndex" title="Locked: The index is locked for changes; apps cannot modify it. Programmatic attempts to modify the index will be ignored.">
                    <i class="icon-lock"></i>
                    <span>Lock</span>
                </a>
            </li>
            <li>
                <a href="#" data-bind="click: $root.lockSideBySide" title="Side-by-side: The index is locked for changes; apps cannot modify it. Programmatic attempts to modify the index will be ignored. Index be can only updated via side-by-side index.">
                    <i class="icon-lock-sidebyside"></i>
                    <span>Lock (Side by Side)</span>
                </a>
            </li>
            <li>
                <a href="#" data-bind="click: $root.lockErrorIndex" title="Locked + Error: The index is locked for changes; apps cannot modify it. An error will be thrown if an app attempts to modify it.">
                    <i class="icon-lock-error"></i>
                    <span>Lock (Error)</span>
                </a>
            </li>
        </ul>
    </div>
</script>